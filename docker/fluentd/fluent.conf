<source>
  @type syslog
  @label @unbound
  bind 0.0.0.0
  port 5140
  protocol_type udp
  format none
  tag unbound
  <parse>
    @type regexp
    expression query: (?<client>\S+) (?<host>\S+)\. (?<record_type>\S+) IN$
  </parse>
</source>

<label @unbound>
  <filter unbound.**>
    @type stdout
  </filter>

  <filter unbound.daemon.info>
    @type geoip
    geoip_lookup_keys host
    # backend_library geoip2_c
    <record>
      # city            ${city.names.en["host"]}
      latitude        ${location.latitude["host"]}
      longitude       ${location.longitude["host"]}
      # country         ${country.iso_code["host"]}
      country_name    ${country.names.en["host"]}
      # region_code     ${subdivisions.0.iso_code["host"]}
      # region_name     ${subdivisions.0.names.en["host"]}
    </record>
    skip_adding_null_record true
  </filter>

  <match unbound.daemon.info>
    @type copy
    <store>
      @type elasticsearch
      host elasticsearch
      port 9200
      type_name unbound
      include_tag_key true
      tag_key @log_name
      logstash_format true
      logstash_prefix unbound
      flush_interval 10s
    </store>
  </match>
</label>
